<!doctype html>
<html lang="en">
<head>
    <title>Chatbot by ndelvoye</title>
    <link href="css/style.css" rel="stylesheet"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.4/socket.io.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
        let socket = io('https://chatbot-ndelvoye.herokuapp.com/');
        // let socket = io('http://localhost:3000/');

        socket.on('msg', (msg) => {
            if (msg.match('https?:\\/\\/(www\\.)?[-a-zA-Z0-9@:%._\\+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_\\+.~#?&//=]*)')) {
                $("#messages").append('<li>(chatbot) # <img height="70px" src ="' + msg + '"  alt="Random GIF generated by Chatbot"/></li>')
            } else {
                $("#messages").append('<li>(chatbot) # ' + msg + '</li>')
            }
            $('#messages').stop().animate({
                scrollTop: $('#messages')[0].scrollHeight
            }, 800);
        });

        // Gestion du temps
        socket.on('time', (timeString) => {
            document.getElementById('server-time').innerHTML = 'Server time: ' + timeString;
        });

        // Gestion des appuis au clavier
        $(document).keypress(function (e) {
            if (e.which === 13) { // Entrée
                if (document.getElementById("question_input").value === "clear") {
                    $("#messages").empty()
                } else {
                    $("#messages").append('<li>(you) # ' + document.getElementById("question_input").value + '</li>')
                    socket.emit('ask', document.getElementById("question_input").value);
                    $('#messages').stop().animate({
                        scrollTop: $('#messages')[0].scrollHeight
                    }, 800);
                }
                document.getElementById("question_input").value = ""
            }
        });

    </script>
</head>
<body>
<header>
    <h1>Chatbot</h1>
    <h2>Réseaux et Flux multimédia - ENSSAT 2020 - IMR3 - ndelvoye</h2>
    <p id="server-time">Server time: Waiting for server...</p>
</header>
<div class="chat">
    <ul id="messages">
    </ul>
    <div id="barre_input">
        <p>></p>
        <input id="question_input" type="text" onblur="this.focus()" autofocus/>
    </div>
</div>
</body>
</html>
